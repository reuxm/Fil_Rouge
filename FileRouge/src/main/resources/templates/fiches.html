<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/headerload :: load">
<meta charset="UTF-8">
<title th:text="Fiches"></title>
</head>
<body>

	<div th:replace="fragments/header :: header"></div>

	<div class="container">
		<table class="table table-hover">
			<thead>
				<tr>
					<th th:text="Creation"></th>
					<th th:text="Auteur"></th>
					<th th:text="Cloture"></th>
					<th th:text="Priorite"></th>
					<th th:text="Client"></th>
					<th th:text="Prix"></th>
					<th th:text="Description"></th>
					<th></th>
				</tr>
			</thead>
			<tbody>
				<tr th:each="f : ${listefiches}" th:href="'/modifierFiche/'+${f.id}" th:classappend="${f.etat} ? table-secondary : table-light">
					<td th:text="${f.dateCreation}"></td>
					<td th:text="${f.user.lastname}"></td>
					<td th:text="${f.dateCloture}"></td>
					<td th:text="${f.priorite.libelle}"></td>
					<td th:text="${f.client.name}"></td>
					<td th:text="${f.prix+(f.prix*f.tva)}"></td>
					<td th:text="${f.description}"></td>
					<td>
						<a th:unless="${f.etat}" class="btn btn-outline-secondary"
						th:href="'/fiches/'+${f.id}" th:text="Modif"></a>
						<a th:unless="${f.etat}" class="btn btn-outline-danger"
						th:href="'/clotureFiche/'+${f.id}" th:text="Cloturer"></a>
						
						<h5><span th:if="${f.etat}" th:text="Clôt" class="badge badge-pill badge-secondary"></span></h5>
					</td>
				</tr>
			</tbody>
		</table>

		<button type="button" class="btn btn-outline-dark" data-toggle="modal"
			data-target="#exampleModal" th:text="Nouvelle"></button>

		<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog"
			aria-labelledby="exampleModalLabel" aria-hidden="true">
			<div class="modal-dialog" role="document">
				<div class="modal-content">
				<form th:object="${form}" action="#" th:action="fiches" method="post">
					<div class="modal-header">
						<h5 class="modal-title" id="exampleModalLabel">Nouvelle fiche</h5>
						<button type="button" class="close" data-dismiss="modal"
							aria-label="Close">
							<span aria-hidden="true">&times;</span>
						</button>
					</div>
					<div class="modal-body">
						<table class="container">
							<tr>
								<td th:text="Description"></td>
								<td>
									<textarea name="description" placeholder="description"></textarea>
								</td>
							</tr>
							<tr>
								<td th:text="Prioritée"></td>
								<td>
									<select name="priorite">
										<option th:each="p : ${listPriorites}" th:value="${p.id}" th:text="${p.libelle}" />
									</select>
								</td>
							</tr>
							<tr>
								<td th:text="Client"></td>
								<td>
									<select name="client">
										<option th:each="c : ${listClients}" th:value="${c.id}" th:text="${c.name}" />
									</select>
								</td>
							</tr>
							<tr>
								<td th:text="Prix"></td>
								<td>
									<input name="prix" type="number" th:value="0"  step="0.01"/>
								</td>
							</tr>
							<tr>
								<td th:text="Tva"></td>
								<td>
									<input name="tva" type="number" th:value="0.2"  step="0.01"/>
								</td>
							</tr>
						</table>
					</div>
					<div class="modal-footer">
						<button type="submit" class="btn btn-outline-success" th:text="Valider"></button>
					</div>
				</form>
				</div>
			</div>
		</div>

	</div>
	<div th:replace="fragments/footer :: footer">&copy; 2020 DTA
		Application Web Gestion de Garage</div>
</body>
</html>